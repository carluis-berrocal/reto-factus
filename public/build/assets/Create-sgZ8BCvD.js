import{q as D,P as V,j as t,B as M,W as A,V as p}from"./app-Cr-pR73H.js";import"./TextInput-CvZSRdA0.js";import{S as g}from"./SelectField-B3JZ-tPz.js";import{A as L}from"./AuthenticatedLayout-BT3I8MvH.js";import{f as d}from"./helpers-Dw4H7AhI.js";import{c as f}from"./createLucideIcon-lGnsTPK_.js";import{P as z,T as U}from"./trash-2-c_tJI96f.js";import"./InputLabel-DfqTxDKB.js";import"./ApplicationLogo-vQvFTnIL.js";import"./transition-CxNJX_Bb.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],E=f("circle-plus",B);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M5 12h14",key:"1ays0h"}]],W=f("minus",Q);function et(){const{products:j=[],customers:v=[],paymentForm:_=[],paymentMethodCode:k=[],flash:b}=D().props,{data:o,setData:l,post:C,processing:w,errors:x}=V({payment_form:"",payment_method_code:"",customer_id:"",observations:"",items:[]}),q=()=>{l("items",[...o.items,{product_id:"",quantity:1,price:0,discount_rate:0,tax_rate:0,is_excluded:!1}])},F=e=>{const s=[...o.items];s.splice(e,1),l("items",s)},u=(e,s,n)=>{const r=[...o.items];if(r[e][s]=n,s==="product_id"){const a=j.find(m=>m.id==n);r[e].price=a?a.price:0,r[e].discount_rate=a?a.discount_rate:0,r[e].tax_rate=a?a.tax_rate:0,r[e].is_excluded=a?a.is_excluded:!1}l("items",r)},P=e=>{u(e,"quantity",o.items[e].quantity+1)},S=e=>{const s=o.items[e].quantity;s>1&&u(e,"quantity",s-1)},y=(()=>{let e=0,s=0,n=0,r=0;return o.items.forEach(a=>{const i=(a.is_excluded?a.price:a.price/(1+a.tax_rate/100))*a.quantity,h=i*(a.discount_rate/100),c=i-h,N=a.is_excluded?0:c*(a.tax_rate/100),I=c+N;e+=i,s+=h,n+=N,r+=I}),{subtotal:e.toFixed(2),totalDiscounts:s.toFixed(2),totalIva:n.toFixed(2),totalToPay:r.toFixed(2)}})(),T=e=>{if(e.preventDefault(),o.items.length===0){p.error("Debes agregar al menos un producto antes de crear la factura.");return}C(route("bills.store"),{onStart:()=>p.loading("Creando factura..."),onSuccess:()=>p.success("Factura creada correctamente."),onError:()=>p.error("Hubo un error al crear la factura."),onFinish:()=>p.dismiss()})};return t.jsxs(L,{header:t.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"Crear Factura"}),children:[t.jsx(M,{title:"Crear Factura"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-6xl space-y-6 sm:px-6 lg:px-8",children:[b.error&&t.jsx("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded mb-4 border border-red-300",children:b.error}),t.jsx("div",{className:"bg-white p-6 shadow-lg sm:rounded-xl dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:t.jsxs("form",{onSubmit:T,className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[t.jsx(g,{label:"Forma de Pago",name:"payment_form",options:_,value:o.payment_form,onChange:l,error:x.payment_form,optionLabel:"name",optionValue:"code",required:!0}),t.jsx(g,{label:"Método de Pago",name:"payment_method_code",options:k,value:o.payment_method_code,onChange:l,error:x.payment_method_code,optionLabel:"name",optionValue:"code",required:!0}),t.jsx(g,{label:"Cliente",name:"customer_id",options:v,value:o.customer_id,onChange:l,error:x.customer_id,optionLabel:"names",optionValue:"id",required:!0}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"observations",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Observaciones"}),t.jsx("textarea",{id:"observations",name:"observations",value:o.observations||"",onChange:e=>l("observations",e.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-900 dark:text-white",placeholder:"Comentarios o información adicional para esta factura..."}),x.observations&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.observations})]})]}),t.jsx("div",{className:"mt-8 overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Producto"}),t.jsx("th",{className:"px-4 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Cantidad"}),t.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Precio"}),t.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Base"}),t.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Descuento"}),t.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-700 dark:text-gray-300",children:"IVA"}),t.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Total"}),t.jsx("th",{className:"px-4 py-2"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[o.items.map((e,s)=>{const r=e.price/(1+(e.is_excluded?0:e.tax_rate/100))*e.quantity,a=r*(e.discount_rate/100),m=r-a,i=e.is_excluded?0:m*(e.tax_rate/100),h=m+i;return t.jsxs("tr",{className:"bg-white dark:bg-gray-800",children:[t.jsx("td",{className:"px-4 py-2",children:t.jsxs("select",{value:e.product_id,onChange:c=>u(s,"product_id",c.target.value),className:"w-full border-gray-300 rounded dark:bg-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Seleccionar producto"}),j.map(c=>t.jsx("option",{value:c.id,children:c.name},c.id))]})}),t.jsx("td",{className:"px-4 py-2 text-center",children:t.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>S(s),className:"text-gray-600 dark:text-gray-300 hover:text-red-600",children:t.jsx(W,{size:16})}),t.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:e.quantity}),t.jsx("button",{type:"button",onClick:()=>P(s),className:"text-gray-600 dark:text-gray-300 hover:text-green-600",children:t.jsx(z,{size:16})})]})}),t.jsx("td",{className:"px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:d(e.price)}),t.jsx("td",{className:"px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:d(r)}),t.jsxs("td",{className:"px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:["-",d(a)]}),t.jsx("td",{className:"px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:d(i)}),t.jsx("td",{className:"px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:d(h)}),t.jsx("td",{className:"px-4 py-2 text-center",children:t.jsx("button",{type:"button",onClick:()=>F(s),className:"text-red-500 hover:text-red-700",children:t.jsx(U,{size:18})})})]},s)}),t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"px-4 py-4 text-center",children:t.jsxs("button",{type:"button",onClick:q,className:"inline-flex items-center text-blue-600 hover:text-blue-800",children:[t.jsx(E,{className:"mr-1",size:18}),"Agregar producto"]})})})]}),t.jsxs("tfoot",{className:"bg-gray-50 dark:bg-gray-900 font-semibold text-gray-700 dark:text-gray-300",children:[t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-4 py-2 text-right",children:"Subtotal:"}),t.jsx("td",{className:"px-4 py-2 text-right",children:d(y.subtotal)}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{})]}),t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-4 py-2 text-right",children:"Total Descuentos:"}),t.jsxs("td",{className:"px-4 py-2 text-right",children:["-",d(y.totalDiscounts)]}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{})]}),t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-4 py-2 text-right",children:"Total IVA:"}),t.jsx("td",{className:"px-4 py-2 text-right",children:d(y.totalIva)}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{})]}),t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-4 py-2 text-right",children:"Total a pagar:"}),t.jsx("td",{className:"px-4 py-2 text-right ",children:d(y.totalToPay)}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{})]})]})]})}),t.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx(A,{href:route("bills.index"),className:"text-sm text-gray-600 hover:underline dark:text-gray-400",children:"Cancelar"}),t.jsx("button",{type:"submit",disabled:w,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Crear Factura"})]})]})})]})})]})}export{et as default};
